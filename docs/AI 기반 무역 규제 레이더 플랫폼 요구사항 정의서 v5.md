

# AI 기반 무역 규제 레이더 플랫폼 요구사항 v5

**과제명**: AI 기반 무역 규제 레이더 플랫폼: ChatGPT 스타일 통합 채팅 및 실시간 SMS/이메일 알림 시스템

---

> HScode 캐시의 정확도를 올리기 위해, 테이블에 저장하기보다는 RAG를 사용하는 편이 정확도 면에서 월등할거라고 판단함. 따라서 벡터 타입을 원활하게 지원하고, AI 프로젝트에서도 많이 쓰이는 DB인 PostgreSQL로 전환함.

## Ⅰ. 개요

### 1. 문서의 목적

본 문서는 "AI 기반 무역 규제 레이더 플랫폼 v5"의 수정된 요구사항을 정의한 문서입니다.

본 플랫폼은 **혁신적인 ChatGPT 스타일의 통합 채팅 시스템**을 통해 복잡한 무역 업무를 단일 자연어 질의로 해결하고, **Claude AI의 실시간 사고과정 표시**로 투명하고 신뢰할 수 있는 분석 결과를 제공하며, **SMS/이메일 기반 일일 알림 시스템**으로 중요한 무역 정보 변동을 정기적으로 알려주는 차세대 무역 정보 플랫폼입니다.

### 2. 핵심 혁신 사항 (v5 수정본)

### 🚀 통합 채팅 시스템 단순화

- **단일 엔드포인트**: POST /api/chat 하나로 모든 채팅 처리
- **직접 SSE 스트리밍**: 별도 스트리밍 엔드포인트 불필요
- **채팅 로직에서 세션 관리 완전 제거**: 복잡한 세션 토큰 관리 완전 제거
- **즉시 응답**: 요청 즉시 실시간 스트리밍 시작

### 📧 완전한 SMS/이메일 통합 알림 생태계

- **휴대폰 인증 시스템**: 6자리 인증코드 기반 휴대폰 번호 검증
- **자동 알림 활성화**: 인증 완료 즉시 기존 북마크 알림 자동 활성화
- **일일 알림 시스템**: 북마크한 항목의 변동사항을 하루마다 SMS/이메일로 통합 알림
- **통합 알림 관리**: 대시보드에서 SMS/이메일 알림을 통합 관리
- **발송 이력 관리**: 시스템 내부 모니터링용 발송 내역 추적

### 🛡️ 단순화된 보안 시스템

- **JWT 기반 무상태 인증**: 확장 가능하고 성능 최적화된 토큰 기반 인증
- **HttpOnly 쿠키 + Refresh Token**: 안전한 토큰 저장 및 자동 갱신 시스템
- **OAuth 소셜 로그인**: Google, Kakao, Naver 통합 지원
- **단순화된 토큰 관리**: 블랙리스트 시스템 제거로 운영 복잡성 감소

### 🤖 AI 기반 RAG 시스템

- **PostgreSQL + pgvector**: 벡터 검색과 관계형 DB 통합 관리
- **HSCode 지식 베이스**: 벡터화된 HSCode 정보로 정확한 분류 제공
- **명확한 근거 제시**: HSCode 판단 근거와 유사 코드 차이점 명시
- **실시간 웹검색 연동**: 최신 정보 반영으로 정확도 향상

### 3. 대상 사용자 (수정본)

### 주요 사용자층

- **중소기업 수출입 담당자**: 복잡한 무역 규제를 쉽게 파악하고 싶은 실무자
- **무역 업무 초보자**: HS Code 분류와 수출입 절차를 학습하고 싶은 신규 담당자
- **소규모 무역업체 운영자**: 전문 인력 없이 무역 업무를 처리해야 하는 소상공인

### 사용자 특성

- **시간 부족**: 복잡한 검색 과정 없이 즉시 답변을 원함
- **전문지식 부족**: 어려운 무역 용어와 절차를 쉽게 이해하고 싶어함
- **실시간성 요구**: 변동사항을 놓치면 큰 손실로 이어질 수 있음
- **신뢰성 중시**: 잘못된 정보로 인한 리스크를 최소화하고 싶어함
- **정보 추적의 어려움**: 복잡한 검색 과정과 여러 사이트들, 수출입 물품들의 규제나 뉴스 등의 알림을 팔로우업 하기 귀찮거나 힘든 상황

### 4. 요구사항 및 문서의 범위

본 문서에서는 다음 내용을 포함합니다:

### 4.1 포함 범위

- **통합 채팅 시스템**: Claude AI 기반 자연어 질의 처리 (회원/비회원 모두 이용 가능)
- **실시간 스트리밍**: 단일 엔드포인트를 통한 즉시 SSE 스트리밍
- **SMS/이메일 통합 알림 시스템**: 휴대폰 인증부터 일일 알림 발송까지
- **자동 알림 활성화**: 휴대폰 인증 완료 시 기존 북마크 알림 자동 활성화
- **사용자 인증**: 자체/소셜 로그인 및 JWT 기반 무상태 인증
- **북마크 및 모니터링**: 관심 항목 저장 및 자동 변동사항 추적
- **대시보드**: 개인화된 정보 허브 및 통합 알림 관리
- **RAG 시스템**: PostgreSQL+pgvector 기반 HSCode 지식 베이스

### 5 제외 범위

- **실제 무역 거래 처리**: 본 플랫폼은 정보 제공 목적으로만 사용
- **법적 책임**: 제공된 정보의 법적 효력이나 책임은 사용자가 별도 확인 필요
- **하드웨어 인프라**: 서버, 네트워크 등 물리적 인프라 구성은 별도 문서
- **타사 API 장애**: 외부 API(관세청, UN COMTRADE 등)의 서비스 중단은 제외
- **관리자 기능**: 추후 필요시 구현 예정 (최후순위)

### 5. 시스템 아키텍처 개요

### 5.1 혁신적 API 구조

```
┌─────────────────────────────────────────────────┐
│             Public API (인증 불필요)              │
│  ┌─────────────────────────────────────────────┐ │
│  │ POST /api/chat (통합 채팅 + 즉시 스트리밍)   │ │
│  │ - 단일 엔드포인트로 모든 처리              │ │
│  │ - 즉시 SSE 스트리밍 시작                  │ │
│  │ - 회員/비회원 모두 이용 가능               │ │
│  └─────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────┐
│            Private API (인증 필요)               │
│  ┌─────────────┐ ┌──────────────┐ ┌────────────┐ │
│  │ JWT 인증     │ │ SMS/이메일   │ │ 북마크 관리 │ │
│  │(무상태 토큰) │ │ 통합 알림    │ │ (자동 모니터링)│ │
│  └─────────────┘ └──────────────┘ └────────────┘ │
└─────────────────────────────────────────────────┘

```

### 5.2 핵심 기술 스택

- **AI 엔진**: Claude AI (사고과정 분석 및 웹검색)
- **실시간 통신**: Server-Sent Events (SSE) - 단일 엔드포인트 통합
- **보안**: JWT 무상태 인증 + HttpOnly Cookie + Token Rotation
- **알림**: SMS/이메일 통합 API 연동
- **데이터**: PostgreSQL 15+ (pgvector 확장) + Spring Data Redis (임시 데이터)
- **RAG 시스템**: Langchain4j + PostgreSQL pgvector

### 6. v5 주요 개선사항

### 6.1 통합 채팅 시스템 단순화

- **복잡한 세션 관리 제거**: 세션 기반 인증 시스템 완전 삭제
- **단일 API 엔드포인트**: POST /api/chat 하나로 모든 채팅 처리
- **즉시 스트리밍**: 별도 스트리밍 요청 없이 즉시 SSE 시작
- **성능 향상**: 무상태 토큰 검증으로 응답 속도 개선

### 6.2 알림 시스템 혁신

- **SMS/이메일 통합**: 단일 알림 시스템으로 두 채널 모두 지원
- **일일 알림**: 즉시 알림 대신 하루마다 변동사항 요약 발송
- **자동 활성화**: 휴대폰 인증 완료 즉시 기존 북마크 알림 자동 활성화
- **통합 관리**: 대시보드에서 SMS/이메일 알림 설정 통합 관리

### 6.3 데이터 구조 최적화

- **세션 저장소 완전 제거**: 무상태 아키텍처로 전환
- **JWT 토큰 관리**: 표준 토큰 기반 인증으로 안정성 향상
- **Redis 역할 단순화**: 임시 데이터 저장소로만 활용
- **PostgreSQL 전환**: MySQL에서 PostgreSQL+pgvector로 통합

### 6.4 RAG 시스템 도입

- **벡터 검색**: HSCode 정보의 의미적 검색 지원
- **정확도 향상**: 유사 HSCode 간 명확한 차이점 제시
- **근거 제시**: HSCode 판단의 명확한 근거와 출처 제공
- **실시간 업데이트**: 웹검색 연동으로 최신 정보 반영

---

## Ⅱ. 유스케이스

### 1. 유스케이스 다이어그램

```
                    AI 기반 무역 규제 레이더 플랫폼 v5 (수정본)
    ┌─────────────────────────────────────────────────────────────────┐
    │                                                                 │
    │  ┌─────────────┐              ┌─────────────────────────────┐    │
    │  │ 회원/비회원  │              │        통합 채팅 시스템      │    │
    │  │             │──────────────│                             │    │
    │  │(모든 사용자) │              │ • 단일 엔드포인트 채팅       │    │
    │  └─────────────┘              │ • 즉시 SSE 스트리밍 응답     │    │
    │         │                     │ • Claude 사고과정 표시      │    │
    │         │                     │ • 상세페이지 이동 버튼 제공  │    │
    │         │                     └─────────────────────────────┘    │
    │         │                                                        │
    │         │ 회원가입/로그인                                        │
    │         ▼                                                        │
    │  ┌─────────────┐                                                 │
    │  │    회원     │              ┌─────────────────────────────┐    │
    │  │             │──────────────│     JWT 기반 인증 시스템     │    │
    │  │(로그인 사용자)│              │                             │    │
    │  └─────────────┘              │ • 자체 회원가입/로그인       │    │
    │         │                     │ • OAuth 소셜 로그인         │    │
    │         │                     │ • JWT 무상태 토큰 관리       │    │
    │         │                     │ • 로그아웃                 │    │
    │         │                     └─────────────────────────────┘    │
    │         │                                                        │
    │         │                     ┌─────────────────────────────┐    │
    │         │─────────────────────│ SMS/이메일 통합 알림 시스템   │    │
    │         │                     │                             │    │
    │         │                     │ • 휴대폰 인증 코드 발송      │    │
    │         │                     │ • 휴대폰 인증 확인          │    │
    │         │                     │ • 휴대폰 번호 등록          │    │
    │         │                     │ • 기존 북마크 알림 자동 활성화│    │
    │         │                     │ • 일일 SMS/이메일 알림 발송  │    │
    │         │                     │ • 대시보드 통합 알림 관리    │    │
    │         │                     └─────────────────────────────┘    │
    │         │                                                        │
    │         │                     ┌─────────────────────────────┐    │
    │         │─────────────────────│      북마크 및 모니터링      │    │
    │         │                     │                             │    │
    │         │                     │ • 북마크 관리 (CRUD)        │    │
    │         │                     │ • 개별 알림 설정 변경       │    │
    │         │                     │ • 자동 모니터링 수행        │    │
    │         │                     │ • 변동사항 감지             │    │
    │         │                     └─────────────────────────────┘    │
    │         │                                                        │
    │         │                     ┌─────────────────────────────┐    │
    │         │─────────────────────│         대시보드            │    │
    │                               │                             │    │
    │                               │ • 대시보드 조회             │    │
    │                               │ • 업데이트 피드 관리        │    │
    │                               │ • 통합 알림 설정 관리       │    │
    │                               │ • 요약 정보 표시            │    │
    │                               └─────────────────────────────┘    │
    │                                                                  │
    │  ┌─────────────┐              ┌─────────────────────────────┐    │
    │  │   시스템     │──────────────│      자동화 프로세스         │    │
    │  │             │              │                             │    │
    │  │(스케줄러)    │              │ • 일일 모니터링 실행         │    │
    │  └─────────────┘              │ • 변동사항 자동 감지         │    │
    │                               │ • 알림 자동 발송            │    │
    │                               │ • 데이터 정리 작업          │    │
    │                               └─────────────────────────────┘    │
    │                                                                  │
    │  ┌─────────────┐              ┌─────────────────────────────┐    │
    │  │   AI 시스템  │──────────────│      RAG 기반 지식베이스     │    │
    │  │             │              │                             │    │
    │  │(Claude AI)   │              │ • HSCode 벡터 검색          │    │
    │  └─────────────┘              │ • 정확한 분류 및 근거 제시   │    │
    │                               │ • 실시간 웹검색 연동        │    │
    │                               │ • 지식 베이스 업데이트       │    │
    │                               └─────────────────────────────┘    │
    └─────────────────────────────────────────────────────────────────┘

```

### 2. 주요 액터 정의

|액터|설명|접근 권한|
|---|---|---|
|**회원/비회원**|서비스를 이용하는 모든 사용자|• 통합 채팅 시스템 모두 사용 가능<br>• 회원가입/로그인 접근 가능|
|**회원**|회원가입을 완료하고 로그인한 인증된 사용자|• 모든 개인화 기능 사용 가능<br>• 북마크, 알림, 대시보드 이용 가능|
|**시스템**|자동화된 백그라운드 프로세스|• 모니터링 및 알림 자동 처리<br>• 데이터 정리 및 유지보수 작업|
|**AI 시스템**|Claude AI 기반 지능형 처리|• 자연어 질의 분석 및 응답<br>• RAG 기반 지식베이스 관리|

### 3. 유스케이스 명세

### 3.1 통합 채팅 시스템 (핵심 - v5 개선)

|유스케이스 이름|**통합 채팅 요청 및 상세페이지 연동**|
|---|---|
|**유스케이스 ID**|UC_CHAT_001|
|**관련 요구사항**|FR-CHAT-001, FR-CHAT-002, FR-CHAT-003, FR-CHAT-004|
|**우선순위**|**최상**|
|**선행조건**|없음 (회원/비회원 모두 사용 가능)|
|**관련 액터**|회원/비회원, AI 시스템|
|**이벤트 흐름**|**1.** 사용자가 메인 화면의 채팅창에 자연어 질문을 입력합니다.<br>**2.** 시스템은 입력된 질문을 Claude AI에게 전달하여 의도 분석을 수행합니다.<br>**3.** Claude AI가 질문이 무역 관련인지 판단하고, 적절한 질문일 경우 처리를 진행합니다.<br>**4.** **[v5 개선]** 별도 세션 생성 없이 즉시 SSE 스트리밍을 시작합니다.<br>**5.** **[병렬 처리 시작]** 다음 두 작업을 병렬로 처리합니다:<br> - **[작업 A]** Thinking 단계 → Main Message 단계 순으로 자연어 응답을 실시간 스트리밍<br> - **[작업 B]** HSCode 캐시 확인 → 상세페이지 정보 생성 → 상세페이지 버튼 데이터 준비<br>**6.** **[프론트엔드 처리]** 병렬로 도착하는 데이터를 실시간으로 표시:<br> - 자연어 응답이 먼저 도착하면 채팅창에 표시<br> - 상세페이지 버튼 데이터가 도착하면 로딩 스피너를 버튼으로 교체<br>**7.** **[상세페이지 버튼 배치]** 사용자 의도에 맞는 순서로 버튼을 왼쪽부터 정렬하여 표시|
|**예외 흐름**|**E1.** 무역과 관련 없는 질문: "무역 관련 질문에만 답변할 수 있습니다"<br>**E2.** 메시지가 너무 짧음: "메시지는 2자 이상이어야 합니다"<br>**E3.** Claude AI 분석 실패: "AI 분석 중 오류가 발생했습니다"<br>**E4.** 상세페이지 정보 생성 실패: 로딩 스피너 유지 및 오류 표시|
|**종료조건**|성공: 완전한 자연어 응답과 상세페이지 이동 버튼 제공<br>실패: 적절한 오류 메시지 표시|

### 3.2 SMS/이메일 통합 알림 시스템 (v5 수정본)

|유스케이스 이름|**휴대폰 인증 및 자동 알림 활성화**|
|---|---|
|**유스케이스 ID**|UC_NOTIFICATION_001|
|**관련 요구사항**|FR-NOTIFICATION-001, FR-NOTIFICATION-002, FR-NOTIFICATION-003|
|**우선순위**|**최상**|
|**선행조건**|회원 로그인 완료|
|**관련 액터**|회원|
|**이벤트 흐름**|**1.** 회원이 대시보드 또는 알림 설정 페이지에서 휴대폰 번호를 입력합니다.<br>**2.** **[사전 안내]** 시스템은 "휴대폰 인증 완료 시 기존 북마크의 SMS/이메일 알림이 자동으로 활성화됩니다"라고 안내합니다.<br>**3.** 사용자가 동의하고 인증을 진행합니다.<br>**4.** 시스템은 입력된 번호의 형식을 검증합니다.<br>**5.** 6자리 인증코드를 생성하고 SMS로 발송합니다.<br>**6.** 시스템은 인증 세션 정보를 Redis에 저장합니다 (5분 만료).<br>**7.** 회원이 받은 인증코드를 입력합니다.<br>**8.** 시스템은 코드를 검증하고 일치할 경우 휴대폰 번호를 계정에 등록합니다.<br>**9.** **[자동 알림 활성화]** 시스템은 다음 작업을 자동으로 수행합니다:<br> - `user_settings.sms_notification_enabled = TRUE`<br> - `user_settings.email_notification_enabled = TRUE`<br> - 모든 기존 북마크의 SMS/이메일 알림을 일괄 활성화<br>**10.** 사용자에게 알림 활성화 완료를 안내합니다.|
|**예외 흐름**|**E1.** 잘못된 번호 형식: "휴대폰 번호 형식이 올바르지 않습니다"<br>**E2.** 이미 인증된 번호: "이미 인증된 휴대폰 번호입니다"<br>**E3.** 발송 한도 초과: "인증 코드 발송 한도를 초과했습니다"<br>**E4.** 잘못된 인증코드: "인증 코드가 올바르지 않습니다"<br>**E5.** 코드 만료: "인증 코드가 만료되었습니다"|
|**종료조건**|성공: 휴대폰 인증 완료 및 모든 알림 자동 활성화<br>실패: 적절한 오류 메시지 표시|

### 3.3 북마크 및 자동 모니터링 시스템 (v5 수정본)

|유스케이스 이름|**북마크 관리 및 자동 모니터링**|
|---|---|
|**유스케이스 ID**|UC_BOOKMARK_001|
|**관련 요구사항**|FR-BOOKMARK-001, FR-BOOKMARK-002, FR-MONITOR-001|
|**우선순위**|**최상**|
|**선행조건**|회원 로그인 완료|
|**관련 액터**|회원|
|**이벤트 흐름**|**[북마크 추가]**<br>**1.** 회원이 상세페이지(HSCode/규제/무역통계)에서 "북마크 추가" 버튼을 클릭합니다.<br>**2.** 시스템은 북마크 추가 폼을 표시합니다.<br>**3.** 회원이 정보를 입력하고 저장합니다.<br>**4.** 시스템은 북마크를 생성하고 자동 증가 ID를 부여합니다.<br>**5.** **[자동 모니터링 등록]** 북마크가 생성되면 자동으로 모니터링 대상에 포함됩니다.<br><br>**[북마크 관리]**<br>**1.** 회원이 대시보드에서 북마크 목록을 조회합니다.<br>**2.** 북마크별로 표시명 수정, SMS/이메일 알림 설정, 삭제 등을 수행할 수 있습니다.<br>**3.** **[알림 설정 규칙]** SMS/이메일 알림이 모두 OFF인 북마크는 모니터링 대상에서 제외됩니다.<br>**4.** 알림 설정이 하나라도 ON인 북마크는 모니터링 대상에 포함됩니다.|
|**예외 흐름**|**E1.** 중복 북마크: "이미 존재하는 북마크입니다"<br>**E2.** 한도 초과: "북마크 개수 한도를 초과했습니다"<br>**E3.** 휴대폰 미인증 시 SMS 설정: "SMS 알림은 휴대폰 인증 후 가능합니다"|
|**종료조건**|성공: 북마크 생성/수정/삭제 완료 및 모니터링 상태 업데이트<br>실패: 적절한 오류 메시지 표시|

### 3.4 사용자 인증 시스템 (v5 단순화)

|유스케이스 이름|**JWT 기반 무상태 인증**|
|---|---|
|**유스케이스 ID**|UC_AUTH_001|
|**관련 요구사항**|FR-AUTH-001, FR-AUTH-002|
|**우선순위**|**최상**|
|**선행조건**|없음|
|**관련 액터**|회원/비회원|
|**이벤트 흐름**|**1.** 사용자가 로그인 페이지에서 로그인 정보를 입력합니다.<br>**2.** 시스템은 사용자 정보를 검증합니다.<br>**3.** **[v5 단순화]** 검증 성공 시 JWT Access Token과 Refresh Token을 생성합니다.<br>**4.** Access Token을 HttpOnly 쿠키로 설정하고 Refresh Token을 안전하게 저장합니다.<br>**5.** 메인 페이지로 리디렉션합니다.|
|**예외 흐름**|**E1.** 잘못된 인증 정보: "이메일 또는 비밀번호가 올바르지 않습니다"<br>**E2.** 계정 잠김: "현재 계정에 일시적인 접근 제한이 적용되었습니다"|
|**종료조건**|성공: 로그인 완료 후 메인 페이지 이동<br>실패: 로그인 페이지에서 오류 메시지 표시|

### 4. 유스케이스 관계 정의 (v5 수정본)

### 4.1 Include 관계 (반드시 포함)

- **대시보드 조회** ← **업데이트 피드 조회**: 대시보드 접근 시 반드시 피드 정보 표시
- **북마크 추가** ← **자동 모니터링 등록**: 북마크 생성 시 자동으로 모니터링 대상에 포함
- **회원가입** ← **기본 설정 생성**: 계정 생성 시 기본 알림 설정 자동 생성
- **휴대폰 인증 완료** ← **기존 북마크 알림 자동 활성화**: 인증 완료 시 자동으로 모든 북마크 알림 활성화

### 5 Extend 관계 (조건부 확장)

- **자동 모니터링** → **SMS/이메일 알림 발송**: 변동사항 감지 시 알림 설정된 경우만 발송
- **통합 채팅 요청** → **상세페이지 버튼 제공**: 무역 관련 질문인 경우에만 상세페이지 버튼 표시
- **알림 설정 변경** → **모니터링 상태 업데이트**: 알림 설정 변경 시 자동으로 모니터링 대상 조정

---

## Ⅲ. 기능 요구사항

### 1. 통합 채팅 시스템 (핵심 혁신 - v5 개선)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-CHAT-001**|**단일 엔드포인트 통합 채팅**|사용자의 자연어 질문을 Claude AI가 분석하여 무역 관련 의도를 파악하고, 즉시 SSE 스트리밍으로 응답을 제공하는 기능 (회원/비회원 모두 이용 가능)|**최상**|`POST /api/chat`|-|
|**FR-CHAT-002**|**Claude 기반 의도 분석**|입력된 질문이 HS Code 분석, 화물 추적, 일반 무역 정보 중 어느 범주에 해당하는지 Claude AI가 자동으로 판별하고, 우선순위에 따라 상세페이지 버튼 순서를 결정하는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-003**|**무역 외 질의 차단**|무역과 관련 없는 질문에 대해서는 적절한 안내 메시지를 제공하고 처리를 거부하는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-004**|**즉시 실시간 SSE 스트리밍**|단일 엔드포인트에서 요청 즉시 Server-Sent Events를 통해 Claude AI의 분석 과정과 최종 답변을 실시간으로 스트리밍하는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-005**|**Thinking 과정 투명화**|Claude AI의 사고과정을 단계별로 실시간 표시하여 사용자가 AI의 분석 과정을 투명하게 확인할 수 있는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-006**|**병렬 처리 시스템**|자연어 응답 생성과 상세페이지 정보 준비를 병렬로 처리하여 전체 응답 시간을 단축하는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-007**|**상세페이지 버튼 생성**|사용자 의도에 맞는 상세페이지(HSCode/규제/무역통계) 이동 버튼을 우선순위에 따라 정렬하여 제공하는 기능|**최상**|`POST /api/chat`|-|
|**FR-CHAT-008**|**RAG 기반 정확도 향상**|PostgreSQL+pgvector 벡터 데이터베이스를 활용하여 HSCode 분류의 정확도를 향상시키고 명확한 근거를 제시하는 기능|**최상**|`POST /api/chat`|`hscode_vectors`|

### 2. SMS/이메일 통합 알림 시스템 (v5 수정본)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-NOTIFICATION-001**|**휴대폰 인증 코드 발송**|사용자가 입력한 휴대폰 번호로 6자리 인증코드를 SMS로 발송하고, 5분 만료 시간과 2분 쿨다운을 적용하는 기능|**최상**|`POST /api/notification/phone/send`|Redis Hash, `notification_logs`|
|**FR-NOTIFICATION-002**|**휴대폰 인증 코드 확인**|발송된 6자리 인증코드를 검증하여 휴대폰 번호 인증을 완료하는 기능 (최대 5회 시도 제한)|**최상**|`POST /api/notification/phone/verify`|Redis Hash|
|**FR-NOTIFICATION-003**|**휴대폰 번호 등록 및 자동 알림 활성화**|인증된 휴대폰 번호를 사용자 계정에 등록하고 SMS/이메일 알림 기능을 활성화하며, 기존 북마크의 알림을 자동으로 활성화하는 기능|**최상**|`POST /api/notification/phone/register`|`users`, `bookmarks`|
|**FR-NOTIFICATION-004**|**통합 알림 설정 관리**|대시보드에서 SMS/이메일 알림의 전체 ON/OFF, 북마크별 알림 설정, 알림 타입별 설정을 통합 관리하는 기능|**최상**|`GET/PUT /api/notification/settings`|`user_settings`, `bookmarks`|
|**FR-NOTIFICATION-005**|**일일 변동사항 통합 알림 발송**|북마크한 HS Code나 화물의 변동사항을 하루마다 SMS와 이메일로 동시 발송하는 기능|**최상**|시스템 자동 처리|`notification_logs`|
|**FR-NOTIFICATION-006**|**알림 내역 시스템 관리**|시스템 내부 모니터링을 위한 모든 SMS/이메일 발송 내역과 상태를 기록하고 관리하는 기능|**상**|시스템 자동 처리|`notification_logs`|
|**FR-NOTIFICATION-007**|**알림 발송 한도 관리**|과도한 SMS/이메일 발송을 방지하기 위한 일일/시간당 발송 한도 및 쿨다운 시간 관리 기능|**상**|시스템 자동 처리|Redis Hash|
|**FR-NOTIFICATION-008**|**개별 북마크 알림 설정 관리**|북마크 관리 페이지에서 각 북마크별로 SMS/이메일 알림을 개별적으로 ON/OFF 할 수 있는 기능|**최상**|`PUT /api/bookmarks/{id}/notifications`|`bookmarks`|
|**FR-NOTIFICATION-009**|**알림 설정 연동 모니터링 관리**|알림 설정이 모두 OFF인 북마크는 모니터링 대상에서 제외하고, 하나라도 ON인 북마크는 모니터링 대상에 포함하는 기능|**최상**|시스템 자동 처리|`bookmarks`|

### 3. 사용자 인증 시스템 (v5 단순화)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-AUTH-001**|**자체 회원가입 및 로그인**|이메일과 비밀번호를 사용한 전통적인 회원가입 및 로그인 기능|**최상**|`POST /api/auth/register`, `POST /api/auth/login`|`users`|
|**FR-AUTH-002**|**OAuth 소셜 로그인**|Google, Kakao, Naver OAuth를 통한 간편 회원가입 및 로그인 기능 (프로필 이미지 자동 연동 포함)|**최상**|`GET /api/oauth2/authorization/{provider}`|`users`, `sns_accounts`|
|**FR-AUTH-003**|**JWT 무상태 인증 시스템**|JWT Access Token과 Refresh Token을 활용한 무상태 인증 및 자동 토큰 갱신 시스템|**최상**|시스템 전체|`users`|
|**FR-AUTH-004**|**Token Rotation 보안**|Refresh Token을 사용한 안전한 토큰 갱신 및 기존 토큰 무효화 처리|**상**|`POST /api/auth/refresh`|`users`|
|**FR-AUTH-005**|**인증 상태 확인**|현재 로그인 상태와 사용자 정보를 확인하는 기능|**상**|`GET /api/auth/verify`|`users`|
|**FR-AUTH-006**|**로그아웃 처리**|안전한 로그아웃 및 토큰 무효화 처리|**상**|`POST /api/auth/logout`|-|
|**FR-AUTH-007**|**회원 정보 수정**|사용자 이름, 비밀번호 등 기본 정보 수정 기능|**상**|별도 구현 필요|`users`|
|**FR-AUTH-008**|**계정 연동 관리**|하나의 이메일로 여러 SNS 계정을 연동하여 관리하는 기능|**중**|OAuth 통합 처리|`sns_accounts`|

### 4. 보안 시스템 (v5 단순화)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-SECURITY-001**|**JWT 토큰 보안**|JWT 토큰의 안전한 생성, 검증, 만료 처리 및 비밀키 관리 기능|**최상**|시스템 전체|-|
|**FR-SECURITY-002**|**Refresh Token Rotation**|보안 강화를 위한 Refresh Token 자동 갱신 및 기존 토큰 무효화 처리|**상**|`POST /api/auth/refresh`|`users`|
|**FR-SECURITY-003**|**Rate Limiting**|API별로 적절한 요청 빈도 제한을 적용하여 DDoS 공격을 방지하는 기능|**상**|모든 API|-|
|**FR-SECURITY-004**|**개인정보 암호화**|휴대폰 번호 등 민감한 개인정보의 AES-256 암호화 저장|**상**|시스템 전체|`users`|
|**FR-SECURITY-005**|**휴대폰 번호 보안 처리**|API 응답 시 휴대폰 번호의 적절한 보안 처리 (필요시 마스킹)|**상**|알림 관련 API|-|

### 5. 북마크 및 모니터링 시스템 (v5 수정본)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-BOOKMARK-001**|**북마크 CRUD 관리**|HS Code나 화물 정보를 북마크로 추가, 조회, 수정, 삭제하는 기능|**최상**|`GET/POST/PUT/DELETE /api/bookmarks`|`bookmarks`|
|**FR-BOOKMARK-002**|**북마크 개인화 설정**|북마크별 표시명, 설명, SMS/이메일 알림 설정을 개별 관리하는 기능|**최상**|`POST/PUT /api/bookmarks`|`bookmarks`|
|**FR-BOOKMARK-003**|**북마크 자동 ID 관리**|각 북마크에 대해 PostgreSQL IDENTITY 컬럼 를 사용하여 관리하는 기능|**상**|북마크 API|`bookmarks`|
|**FR-MONITOR-001**|**자동 모니터링 시스템**|알림 설정이 활성화된 북마크에 대해 일일 변동사항을 자동 감지하는 기능|**최상**|스케줄러 자동 처리|`bookmarks`, `update_feeds`|
|**FR-MONITOR-002**|**변동사항 감지 및 알림**|HS Code 관세율 변경, 규제 업데이트, 화물 상태 변경 등을 감지하고 SMS/이메일로 알림을 발송하는 기능|**최상**|시스템 자동 처리|`update_feeds`|
|**FR-MONITOR-003**|**모니터링 상태 관리**|북마크의 알림 설정 상태에 따라 모니터링 대상 포함/제외를 자동 관리하는 기능|**최상**|시스템 자동 처리|`bookmarks`|

### 6. 대시보드 및 피드 시스템 (v5 수정본)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-DASHBOARD-001**|**개인화 대시보드**|사용자별 북마크, 업데이트 피드, 통합 알림 설정을 관리하는 개인화된 대시보드 기능|**최상**|`GET /api/dashboard/summary`|`v_user_dashboard_summary`|
|**FR-DASHBOARD-002**|**업데이트 피드 조회**|북마크한 항목들의 변동사항을 시간순으로 정렬된 피드 형태로 제공하는 기능|**최상**|`GET /api/dashboard/feeds`|`update_feeds`|
|**FR-DASHBOARD-003**|**피드 읽음 처리**|개별 피드나 전체 피드를 읽음 상태로 표시하여 새로운 정보를 구분하는 기능|**상**|`PUT /api/dashboard/feeds/{feedId}/read`, `PUT /api/dashboard/feeds/read-all`|`update_feeds`|
|**FR-DASHBOARD-004**|**요약 통계 정보**|총 북마크 수, 읽지 않은 피드 수, 알림 설정 현황 등 주요 지표를 요약하여 제공하는 기능|**상**|`GET /api/dashboard/summary`|여러 테이블 조인|
|**FR-DASHBOARD-005**|**통합 알림 설정 관리**|대시보드에서 SMS/이메일 알림을 통합 관리하는 기능|**최상**|`GET/PUT /api/notification/settings`|`user_settings`|
|**FR-DASHBOARD-006**|**피드 요약 정보**|각 피드에 대해 변동사항 요약 정보를 제공하는 기능 (상세 비교 기능 제외)|**상**|`GET /api/dashboard/feeds`|`update_feeds`|

### 7. RAG 시스템 (v5 신규)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-RAG-001**|**HSCode 벡터 저장소**|PostgreSQL+pgvector를 활용한 HSCode 정보의 벡터 저장 및 검색 기능|**최상**|`POST /api/chat`|`hscode_vectors`|
|**FR-RAG-002**|**의미적 검색 기능**|자연어 질의에 대해 의미적으로 유사한 HSCode 정보를 검색하는 기능|**최상**|`POST /api/chat`|`hscode_vectors`|
|**FR-RAG-003**|**정확한 분류 근거 제시**|HSCode 분류 시 명확한 근거와 유사 코드와의 차이점을 제시하는 기능|**최상**|`POST /api/chat`|`hscode_vectors`|
|**FR-RAG-004**|**실시간 지식 업데이트**|웹검색을 통해 새로운 HSCode 정보를 발견하면 벡터 데이터베이스에 저장하는 기능|**상**|`POST /api/chat`|`hscode_vectors`|
|**FR-RAG-005**|**지식 베이스 품질 관리**|저장된 HSCode 정보의 품질을 유지하고 중복을 방지하는 기능|**상**|시스템 자동 처리|`hscode_vectors`|

### 8. 시스템 관리 및 데이터 정리 (v5 단순화)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-SYSTEM-001**|**Spring Boot 데이터 정리**|만료된 인증 세션, 임시 데이터 등을 Spring Boot에서 일괄 처리하는 기능|**중**|스케줄러 자동 처리|여러 테이블|
|**FR-SYSTEM-002**|**외부 API 연동 관리**|관세청, UN COMTRADE 등 외부 API와의 안정적인 연동 및 오류 처리|**상**|시스템 전체|-|
|**FR-SYSTEM-003**|**Redis 임시 데이터 관리**|인증 세션, 캐시 데이터 등 Redis 임시 데이터의 생명주기 관리|**상**|시스템 자동 처리|Redis Hash|
|**FR-SYSTEM-004**|**모니터링 로그 관리**|Claude API 사용량 추적을 위한 모니터링 로그 기록 및 관리 (후순위 구현)|**하**|시스템 자동 처리|`monitor_logs`|

### 9. UI/UX 사용자 인터페이스 (v5 개선)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-UI-001**|**ChatGPT 스타일 채팅 인터페이스**|메인 화면 중앙에 배치된 직관적인 채팅창과 실시간 스트리밍 응답을 표시하는 현대적 UI|**최상**|`POST /api/chat`|-|
|**FR-UI-002**|**Thinking + Main Message 분리 표시**|AI의 사고과정과 최종 답변을 명확히 구분하여 표시하는 이중 영역 채팅 인터페이스|**최상**|`POST /api/chat`|-|
|**FR-UI-003**|**상세페이지 이동 버튼 UI**|채팅 섹션 하단에 의도별 우선순위에 따라 정렬된 상세페이지 이동 버튼들을 표시하는 UI|**최상**|`POST /api/chat`|-|
|**FR-UI-004**|**병렬 처리 로딩 표시**|상세페이지 버튼들이 준비되기 전까지 로딩 스피너를 표시하고 준비되는 대로 버튼으로 교체하는 UI|**최상**|`POST /api/chat`|-|
|**FR-UI-005**|**반응형 웹 디자인**|데스크톱, 태블릿, 모바일 등 모든 디바이스에서 최적화된 UI/UX 제공|**상**|모든 화면|-|
|**FR-UI-006**|**통합 알림 관리 대시보드**|SMS/이메일 알림을 통합 관리하는 직관적인 대시보드 인터페이스|**최상**|대시보드 API|-|
|**FR-UI-007**|**개별 북마크 알림 토글**|북마크 관리 페이지에서 각 북마크별로 SMS/이메일 알림을 ON/OFF 할 수 있는 토글 UI|**최상**|북마크 API|-|
|**FR-UI-008**|**다크/라이트 모드**|사용자 선호도에 따른 테마 전환 기능 및 시스템 설정 자동 감지|**중**|클라이언트 설정|-|
|**FR-UI-009**|**접근성 지원**|스크린 리더, 키보드 내비게이션, 고대비 모드 등 웹 접근성 표준 준수|**중**|모든 화면|-|
|**FR-UI-010**|**다국어 지원**|한국어/영어 지원 및 향후 다국어 확장을 위한 국제화(i18n) 기반 구조 (최하순위)|**하**|클라이언트 설정|-|

### 10. 외부 연동 시스템 (v5 유지)

|ID|요구사항명칭|설명|우선순위|관련 API|관련 테이블|
|---|---|---|---|---|---|
|**FR-EXTERNAL-001**|**관세청 API 연동**|수입화물 진행정보, 관세환율 등 관세청 공개 API와의 안정적 연동|**상**|외부 API 호출|`hscode_vectors`|
|**FR-EXTERNAL-002**|**UN COMTRADE API 연동**|국제 무역 통계 데이터 조회를 위한 UN COMTRADE API 연동|**상**|외부 API 호출|`hscode_vectors`|
|**FR-EXTERNAL-003**|**SMS 서비스 API 연동**|휴대폰 인증 및 알림을 위한 외부 SMS 발송 서비스 연동|**최상**|SMS API|`notification_logs`|
|**FR-EXTERNAL-004**|**이메일 서비스 연동**|알림 발송을 위한 SMTP 또는 이메일 서비스 API 연동|**상**|시스템 자동 처리|`notification_logs`|
|**FR-EXTERNAL-005**|**웹검색 엔진 연동**|Claude AI의 실시간 웹검색을 위한 검색 엔진 API 연동|**최상**|`POST /api/chat`|-|

---

## Ⅳ. 비기능 요구사항

### 1. 성능 요구사항 (v5 개선)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-PERF-001**|**채팅 응답 시작 시간**|통합 채팅 요청 후 첫 번째 스트리밍 응답까지의 시간이 1초 이내여야 함|95th percentile < 1초|MVP 테스트 시|
|**NFR-PERF-002**|**Claude AI 분석 완료 시간**|단일 질의에 대한 Claude AI 분석이 30초 이내에 완료되어야 함|평균 < 30초|MVP 테스트 시|
|**NFR-PERF-003**|**SMS 발송 처리 시간**|SMS 인증코드 발송 요청 후 실제 발송까지 5초 이내 처리|95th percentile < 5초|MVP 테스트 시|
|**NFR-PERF-004**|**API 응답 시간**|일반 API 요청의 응답 시간이 1초 이내여야 함|95th percentile < 1초|MVP 테스트 시|
|**NFR-PERF-005**|**동시 접속자 처리**|최소 100명의 동시 사용자를 안정적으로 처리할 수 있어야 함|100 concurrent users|운영 환경|
|**NFR-PERF-006**|**벡터 검색 성능**|PostgreSQL+pgvector 기반 의미적 검색이 500ms 이내에 응답해야 함|평균 < 500ms|MVP 테스트 시|
|**NFR-PERF-007**|**병렬 처리 성능**|자연어 응답과 상세페이지 준비의 병렬 처리로 전체 응답 시간 30% 단축|기존 대비 30% 향상|MVP 테스트 시|
|**NFR-PERF-008**|**JWT 인증 성능 향상**|무상태 토큰 검증으로 전체 시스템 응답 속도 50% 향상|기존 대비 50% 향상|MVP 테스트 시|

### 2. 보안 요구사항 (v5 단순화)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-SEC-001**|**데이터 암호화**|모든 민감한 개인정보는 AES-256 암호화로 저장되어야 함|AES-256 적용률 100%|설계 시|
|**NFR-SEC-002**|**HTTPS 통신**|모든 클라이언트-서버 통신은 HTTPS를 통해 암호화되어야 함|SSL/TLS 적용률 100%|운영 환경|
|**NFR-SEC-003**|**JWT 토큰 보안**|JWT 토큰의 안전한 생성, 저장, 검증 프로세스 및 토큰 탈취 방지 메커니즘|HttpOnly 쿠키 적용|설계 시|
|**NFR-SEC-004**|**Rate Limiting**|API별로 적절한 요청 빈도 제한을 적용하여 DDoS 공격을 방지해야 함|설정된 한도 준수|운영 환경|
|**NFR-SEC-005**|**개인정보 보안 처리**|로그 및 API 응답에서 개인정보가 적절히 보호되도록 처리|보안 처리율 100%|설계 시|
|**NFR-SEC-006**|**SQL Injection 방지**|모든 데이터베이스 쿼리는 Prepared Statement를 사용하여 SQL Injection을 방지|취약점 0건|개발 시|
|**NFR-SEC-007**|**알림 설정 권한 검증**|북마크 알림 설정 변경 시 해당 북마크의 소유자 권한을 엄격히 검증|권한 검증 100%|개발 시|

### 3. 안정성 요구사항 (v5 개선)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-REL-001**|**시스템 가용성**|시스템은 월 99.5% 이상의 가용성을 유지해야 함|Uptime > 99.5%|운영 환경|
|**NFR-REL-002**|**장애 복구 시간**|시스템 장애 발생 시 30분 이내에 서비스를 복구해야 함|MTTR < 30분|운영 환경|
|**NFR-REL-003**|**데이터 백업**|모든 중요 데이터는 일일 자동 백업되어야 하며, 복구 테스트를 월 1회 실시|백업 성공률 100%|운영 환경|
|**NFR-REL-004**|**외부 API 장애 대응**|외부 API 장애 시에도 핵심 기능은 제한적으로라도 동작해야 함|핵심 기능 가용성 > 90%|운영 환경|
|**NFR-REL-005**|**자동 모니터링 신뢰성**|북마크 모니터링 시스템의 변동사항 감지율이 95% 이상이어야 함|감지율 > 95%|MVP 테스트 시|
|**NFR-REL-006**|**알림 발송 신뢰성**|SMS/이메일 알림 발송 성공률이 98% 이상이어야 함|발송 성공률 > 98%|MVP 테스트 시|
|**NFR-REL-007**|**무상태 아키텍처 안정성**|JWT 기반 무상태 구조의 안정성 향상|오류율 < 0.1%|MVP 테스트 시|

### 4. 확장성 요구사항 (v5 개선)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-SCAL-001**|**사용자 확장성**|시스템은 10,000명의 등록 사용자까지 확장 가능해야 함|10K users 지원|향후 확장 시|
|**NFR-SCAL-002**|**데이터 확장성**|PostgreSQL+pgvector는 1억 건의 벡터 데이터까지 성능 저하 없이 처리 가능해야 함|100M vectors 지원|향후 확장 시|
|**NFR-SCAL-003**|**모듈형 아키텍처**|새로운 기능 추가 시 기존 시스템에 영향을 최소화하는 모듈형 구조|무영향 배포 가능|설계 시|
|**NFR-SCAL-004**|**마이크로서비스 지원**|향후 마이크로서비스 분리가 가능한 느슨한 결합 구조|서비스 분리 가능|설계 시|
|**NFR-SCAL-005**|**벡터 DB 확장성**|pgvector 인덱스 최적화를 통한 벡터 검색 성능 확장 지원|인덱스 최적화 적용|향후 확장 시|
|**NFR-SCAL-006**|**JWT 무상태 확장성**|JWT 무상태 특성을 활용한 수평 확장 최적화|서버 독립적 확장|향후 확장 시|

### 5. 사용성 요구사항 (v5 개선)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-USAB-001**|**직관적 인터페이스**|새로운 사용자가 5분 이내에 기본 기능을 사용할 수 있어야 함|학습 시간 < 5분|UI/UX 테스트 시|
|**NFR-USAB-002**|**모바일 사용성**|모바일 환경에서도 데스크톱과 동일한 수준의 사용성을 제공해야 함|모바일 만족도 > 4.0/5.0|UI/UX 테스트 시|
|**NFR-USAB-003**|**오류 메시지 명확성**|모든 오류 상황에서 사용자가 이해할 수 있는 명확한 안내 메시지 제공|오류 해결률 > 90%|MVP 테스트 시|
|**NFR-USAB-004**|**접근성 표준 준수**|웹 접근성 가이드라인(WCAG 2.1 AA) 준수|WCAG 2.1 AA 준수|UI/UX 테스트 시|
|**NFR-USAB-005**|**브라우저 호환성**|Chrome, Firefox, Safari, Edge 최신 버전에서 완전 동작|주요 브라우저 100% 지원|테스트 시|
|**NFR-USAB-006**|**알림 설정 프로세스 직관성**|휴대폰 인증부터 알림 설정까지의 전체 프로세스를 사용자가 직관적으로 이해할 수 있어야 함|프로세스 이해도 > 90%|UI/UX 테스트 시|
|**NFR-USAB-007**|**설정 변경 즉시 반영**|개별 북마크 알림 설정 변경 시 즉시 UI에서 상태가 반영되어야 함|반영 시간 < 1초|UI/UX 테스트 시|
|**NFR-USAB-008**|**단순화된 인증 경험**|JWT 기반 무상태 인증으로 인한 더욱 직관적인 사용자 경험|사용자 만족도 > 4.5/5.0|UI/UX 테스트 시|

### 6. 운영 및 유지보수 요구사항 (v5 단순화)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-OPR-001**|**기본 로그 관리**|주요 이벤트와 오류는 기본 로그로 기록되어 7일간 보관 (상세 로그는 후순위)|로그 커버리지 > 80%|개발 시|
|**NFR-OPR-002**|**기본 모니터링**|시스템 상태와 주요 오류를 기본 모니터링 (고급 모니터링은 후순위)|기본 모니터링 100%|운영 환경|
|**NFR-OPR-003**|**수동 배포 지원**|안정적인 수동 배포 프로세스 지원 (CI/CD는 최후순위)|배포 성공률 100%|운영 환경|
|**NFR-OPR-004**|**Spring Boot 데이터 정리**|Spring Boot에서 일괄 처리되는 데이터 정리 작업의 안정성 보장|정리 작업 성공률 100%|운영 환경|
|**NFR-OPR-005**|**기본 문서화**|API 문서, 기본 운영 가이드 등 필수 문서화 (상세 문서는 후순위)|문서 완성도 > 80%|운영 환경|
|**NFR-OPR-006**|**단순화된 운영 관리**|JWT 기반 무상태 아키텍처로 인한 운영 복잡성 감소 및 장애 대응 간소화|장애 대응 시간 < 15분|운영 환경|

### 7. 호환성 요구사항 (v5 개선)

|ID|요구사항명칭|설명|측정 기준|적용 시점|
|---|---|---|---|---|
|**NFR-COMP-001**|**PostgreSQL 호환성**|PostgreSQL 15+ 및 pgvector 확장에서 완전 동작|PostgreSQL 15+ 지원|설계 시|
|**NFR-COMP-002**|**Spring Boot 호환성**|Spring Boot 3.5+ 사용 및 향후 버전 업그레이드 지원|Spring Boot 3.5+|개발 시|
|**NFR-COMP-003**|**Langchain4j 호환성**|Langchain4j 최신 버전과 호환되며, pgvector 통합 지원|Langchain4j 호환성|개발 시|
|**NFR-COMP-004**|**Redis 호환성**|Redis 6.0 이상에서 동작하며, 임시 데이터 저장 지원|Redis 6.0+ 지원|설계 시|
|**NFR-COMP-005**|**외부 API 버전 관리**|관세청, UN COMTRADE 등 외부 API 버전 변경에 대한 유연한 대응|API 버전 호환성 유지|운영 환경|
|**NFR-COMP-006**|**JWT 표준 호환성**|JWT 표준(RFC 7519) 완전 준수 및 주요 라이브러리 호환성 유지|JWT 표준 100% 준수|개발 시|

---

## Ⅴ. 기술 스택 및 아키텍처

### 1. 핵심 기술 스택 (v5 확정)

### 1.1 백엔드 기술 스택

- **Java**: 21 LTS (호환성: Java 21+)
- **Spring Boot**: 3.5+
- **Spring Security**: JWT 기반 무상태 인증
- **Langchain4j**: AI 통합 및 RAG 구현
- **PostgreSQL**: 15+ (pgvector 확장 포함)
- **Redis**: 6.0+ (임시 데이터 저장)

### 1.2 AI 및 벡터 DB

- **Claude AI**: 자연어 처리 및 의도 분석
- **PostgreSQL + pgvector**: 벡터 검색 및 RAG 시스템
- **OpenAI Embeddings**: 텍스트 벡터화 (또는 대안 모델)

### 1.3 외부 연동

- **SMS API**: 휴대폰 인증 및 알림
- **Email SMTP**: 이메일 알림
- **웹검색 API**: 실시간 정보 수집

### 2. 시스템 플로우 (v5 수정본)

### 2.1 채팅 요청 처리 플로우

```
사용자 질문 입력
    ↓
POST /api/chat 요청
    ↓
SSE 연결 즉시 시작
    ↓
[병렬 처리 시작]
    ↓                    ↓
[작업 A: 자연어 응답]    [작업 B: 상세페이지 준비]
    ↓                    ↓
Claude 의도 분석        HSCode 벡터 검색
    ↓                    ↓
Thinking 스트리밍       캐시 확인/생성
    ↓                    ↓
Main Message 스트리밍   상세 정보 병렬 생성
    ↓                    ↓
[프론트엔드에서 실시간 표시]
    ↓
채팅 응답 + 상세페이지 버튼 완성

```

### 2.2 휴대폰 인증 및 알림 활성화 플로우

```
휴대폰 번호 등록 시도
    ↓
사전 안내 메시지 표시
("인증 완료 시 기존 북마크 알림이 자동 활성화됩니다")
    ↓
사용자 동의 확인
    ↓
SMS 인증코드 발송
    ↓
사용자 코드 입력
    ↓
인증 성공
    ↓
[자동 실행]
- user_settings 알림 활성화
- 모든 기존 북마크 알림 활성화
- 완료 안내 메시지 표시

```

### 2.3 일일 모니터링 및 알림 플로우

```
스케줄러 (매일 0시 실행) 
    ↓
알림 설정이 활성화된 북마크 조회
    ↓
각 북마크별 변동사항 확인
    ↓
변동사항 감지 시
    ↓
사용자별 변동사항 그룹핑
    ↓
SMS/이메일 동시 발송
    ↓
notification_logs 기록

```

---

## Ⅵ. 결론

### 1. 요구사항 우선순위 매트릭스 (v5 수정본)

|우선순위|요구사항 수|주요 영역|완료 목표|
|---|---|---|---|
|**최상 (Critical)**|28개|**JWT 무상태 인증**, 단일 엔드포인트 채팅, **SMS/이메일 통합 알림**, RAG 시스템, 북마크|MVP 완료 시|
|**상 (High)**|32개|UI/UX, 대시보드, 성능, 안정성, 보안|MVP 안정화 시|
|**중 (Medium)**|12개|시스템 관리, 접근성, 테마 기능|정식 출시 시|
|**하 (Low)**|8개|고급 모니터링, CI/CD, 다국어|향후 업데이트|

### 2. v5 핵심 혁신 사항 요약

### 🎯 **비즈니스 가치**

- **중소기업 맞춤형 설계**: 전문가가 아닌 실무자 중심의 직관적 인터페이스
- **업무 효율성 대폭 향상**: 복잡한 검색과 모니터링 과정을 AI가 자동화
- **정보 누락 방지**: 일일 통합 알림으로 중요 변동사항 놓치지 않음
- **운영 복잡성 최소화**: 단순화된 아키텍처로 유지보수 부담 감소

### 🚀 **기술적 혁신**

- **PostgreSQL + pgvector 통합**: 관계형 DB와 벡터 검색의 완벽한 결합
- **RAG 기반 정확도 향상**: HSCode 분류의 명확한 근거와 차이점 제시
- **병렬 처리 시스템**: 자연어 응답과 상세페이지 준비의 동시 처리
- **단순화된 보안 모델**: 토큰 블랙리스트 제거로 운영 효율성 향상

### 📧 **사용자 경험 혁신**

- **통합 알림 시스템**: SMS/이메일 통합 관리로 일관된 사용자 경험
- **자동 알림 활성화**: 번거로운 설정 과정 없이 즉시 서비스 이용 가능
- **의도 기반 UI**: 사용자 의도에 맞는 상세페이지 버튼 우선순위 배치
- **투명한 AI 과정**: Thinking 단계 표시로 AI 판단 과정 투명화

### 3. v5 주요 변경사항 상세

### 🔄 **아키텍처 변경사항**

|구분|변경 전 (원본)|변경 후 (v5 수정본)|변경 이유|
|---|---|---|---|
|**데이터베이스**|MySQL + 별도 벡터 DB|PostgreSQL + pgvector 통합|Spring Boot & Langchain4j 최적화|
|**알림 시스템**|SMS 단독 + 브라우저 Push|SMS/이메일 통합|사용자 편의성 및 도달률 향상|
|**알림 주기**|즉시 알림|일일 통합 알림|사용자 피로도 감소|
|**사용자 동의**|사용자 확인 후 활성화|인증 즉시 자동 활성화|사용성 개선|
|**보안 모델**|토큰 블랙리스트 포함|블랙리스트 제거|운영 복잡성 감소|

### 📊 **기능 변경사항**

|기능|변경 전|변경 후|개선 효과|
|---|---|---|---|
|**북마크 추가**|채팅 응답에서 직접 추가|상세페이지에서 추가|자연스러운 사용자 플로우|
|**상세페이지 연동**|별도 분석 수행|병렬 처리로 미리 준비|응답 시간 30% 단축|
|**모니터링 활성화**|별도 옵션 설정|알림 설정과 연동|설정 복잡성 제거|
|**관리자 기능**|포함|제거 (후순위)|핵심 기능 집중|

### 4. 성공 지표 (KPI) - v5 수정본

|지표 분류|측정 항목|목표 값|측정 주기|
|---|---|---|---|
|**사용자 만족도**|중소기업 실무자 만족도|4.8/5.0 이상|월간|
|**업무 효율성**|정보 검색 시간 단축|85% 이상 단축|분기|
|**시스템 성능**|채팅 + 상세페이지 통합 응답 시간|30초 이내|실시간|
|**서비스 안정성**|PostgreSQL 통합 시스템 가용성|99.7% 이상|월간|
|**알림 효과**|일일 통합 알림 만족도|4.5/5.0 이상|월간|
|**정보 정확도**|RAG 기반 HSCode 분류 정확도|95% 이상|월간|
|**설정 편의성**|자동 알림 활성화 완료율|90% 이상|월간|
|**운영 효율성**|시스템 운영 복잡성 감소|60% 이상 단순화|분기|

### 5. 향후 발전 계획 (v5 기준)

### Phase 1: MVP v5

- ✅ PostgreSQL + pgvector RAG 시스템 구축
- ✅ 단일 엔드포인트 채팅 + 병렬 처리 구현
- ✅ JWT 기반 무상태 인증 시스템 구축
- ✅ SMS/이메일 통합 알림 시스템 구현
- ✅ 자동 알림 활성화 프로세스 구현

### Phase 2: 베타 서비스

- 성능 최적화 및 안정성 강화
- 고급 UI/UX 및 접근성 개선
- 외부 API 연동 확장
- 벡터 검색 정확도 고도화

### Phase 3: 정식 출시

- 모니터링 로그 시스템 구현
- 고급 분석 기능 및 리포트
- 기업용 기능 확장
- 관리자 기능 구현

### Phase 4: 고도화

- CI/CD 파이프라인 구축
- 고급 모니터링 시스템
- 다국어 지원
- 마이크로서비스 전환 준비

### 6. 리스크 관리 (v5 수정본)

|리스크|확률|영향도|대응 방안|
|---|---|---|---|
|**PostgreSQL 전환 복잡성**|중|중|단계적 마이그레이션, 충분한 테스트 기간 확보|
|**RAG 시스템 구현 난이도**|중|높음|Langchain4j 예제 활용, 점진적 고도화|
|**Claude AI API 제한**|중|높음|대체 AI 모델 준비, 캐싱 강화|
|**외부 API 변경**|높음|중|어댑터 패턴, 버전 관리 시스템|
|**알림 발송 비용 증가**|중|중|일일 발송으로 비용 절약, 발송 한도 관리|
|**보안 취약점**|낮음|높음|정기 보안 감사, JWT 토큰 보안 강화|

### 7. 개발 우선순위 가이드 (v5 수정본)

### 🚨 **즉시 구현필요 (Critical Path)**

1. PostgreSQL + pgvector 환경 구축
2. Langchain4j 통합 및 기본 RAG 구현
3. 단일 엔드포인트 POST /api/chat 구현
4. JWT 무상태 인증 시스템 구현

### ⚡ **우선 구현 (High Priority)**

1. SMS/이메일 통합 알림 시스템
2. 자동 알림 활성화 프로세스
3. 병렬 처리 시스템 (자연어 응답 + 상세페이지)
4. 기본 북마크 및 모니터링 기능

### 🔧 **안정화 단계 (Medium Priority)**

1. 벡터 검색 정확도 최적화
2. 대시보드 및 통합 알림 관리 UI
3. 기본 성능 최적화
4. 오류 처리 및 예외 상황 대응

### 8. PostgreSQL 전환 전략

### 8.1 마이그레이션 단계

1. **환경 준비**: PostgreSQL 15+ + pgvector 설치
2. **스키마 전환**: MySQL → PostgreSQL DDL 변환
3. **데이터 마이그레이션**: 기존 데이터 이관 (필요시)
4. **애플리케이션 수정**: JPA 설정 및 쿼리 조정
5. **통합 테스트**: 전체 시스템 안정성 검증

### 9. 품질 보증 전략

### 9.1 핵심 테스트 계획

|테스트 유형|범위|목표|우선순위|
|---|---|---|---|
|**벡터 검색 테스트**|RAG 시스템|정확도 95% 이상|최상|
|**통합 알림 테스트**|SMS/이메일 발송|발송 성공률 98% 이상|최상|
|**병렬 처리 테스트**|채팅 + 상세페이지|응답 시간 30% 단축|최상|
|**JWT 인증 테스트**|보안 시스템|토큰 검증 100%|최상|
|**성능 테스트**|전체 시스템|NFR 요구사항 만족|상|

### 9.2 품질 지표

- **코드 품질**: 핵심 비즈니스 로직 80% 이상 테스트 커버리지
- **API 성능**: 95th percentile 응답 시간 1초 이내
- **시스템 안정성**: 99.5% 이상 가용성
- **보안 기준**: JWT 표준 완전 준수

### 10. 최종 권고사항

### 10.1 즉시 실행사항

1. **PostgreSQL + pgvector 환경 구축**: 개발 환경부터 신속한 구축
2. **Langchain4j 학습**: 개발팀 대상 기술 교육 및 예제 실습
3. **프로토타입 개발**: 핵심 RAG 기능의 빠른 프로토타입 구현
4. **알림 시스템 설계**: SMS/이메일 통합 발송 로직 상세 설계

### 10.2 성공 요인

1. **점진적 구현**: 복잡한 RAG 시스템을 단계별로 구현
2. **사용자 피드백**: 중소기업 실무자 대상 조기 테스트
3. **성능 모니터링**: 벡터 검색 성능 지속적 최적화
4. **운영 준비**: 단순화된 아키텍처 활용한 안정적 운영

### 11. 문서 버전 관리

### 11.1 주요 변경사항 추적

- **v5 수정본**: PostgreSQL+pgvector 전환, SMS/이메일 통합, 자동 알림 활성화
- **변경 근거**: 37개 문제점 분석 및 해결
- **기술 스택 확정**: Spring Boot 3.5+ & Langchain4j 최적화
- **우선순위 재조정**: 중소기업 중심 기능 우선 구현

### 11.2 다음 버전 계획

- **v4.3 계획**: 성능 최적화 및 고급 RAG 기능
- **v5.0 계획**: 마이크로서비스 아키텍처 전환 검토
- **Long-term**: 글로벌 확장 및 다국어 지원